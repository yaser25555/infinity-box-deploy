<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceBoom Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Amiri&family=Scheherazade+New:wght@400;700&family=Noto+Naskh+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Naskh Arabic', sans-serif;
            color: #E0E0E0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            overflow-x: hidden;
            position: relative;
            z-index: 0;

            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-image: url('background_image.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%);
            z-index: -1;
        }

        .main-content {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
            margin-top: 20px;
            padding-right: 420px; /* Space for the fixed sidebar */
        }

        .right-panel {
            position: fixed;
            top: 20px;
            right: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 380px;
            z-index: 50;
            padding: 0 20px;
        }

        .player-info {
            position: relative;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 35px;
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            min-width: 320px;
        }

        .player-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .player-details {
            display: flex;
            flex-direction: column;
            line-height: 1.4;
        }

        .player-details p {
            margin: 0;
            font-size: 1.1em;
            white-space: nowrap;
            font-weight: 600;
        }

        .player-details p:first-child {
            font-weight: bold;
            font-size: 1.3em;
            color: #FFD700;
        }

        .player-actions {
            display: flex;
            gap: 12px;
        }

        .player-actions button {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 1.3em;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            backdrop-filter: blur(10px);
        }

        .player-actions button:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.2) 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .game-container {
            width: 100%;
            max-width: 900px;
            position: relative;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 30px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            padding: 30px;
            min-height: 700px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .game-container:hover {
            box-shadow: 
                0 25px 80px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .message-area {
            margin-bottom: 30px;
            font-size: 1.4em;
            font-weight: bold;
            min-height: 40px;
            text-align: center;
            padding: 15px 20px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            z-index: 6;
        }

        .message-area.success { 
            color: #4ade80; 
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2) 0%, rgba(74, 222, 128, 0.1) 100%);
            border-color: rgba(74, 222, 128, 0.3);
            box-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
        }
        
        .message-area.error { 
            color: #f87171; 
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.2) 0%, rgba(248, 113, 113, 0.1) 100%);
            border-color: rgba(248, 113, 113, 0.3);
            box-shadow: 0 0 20px rgba(248, 113, 113, 0.3);
        }
        
        .message-area.info { 
            color: #60a5fa; 
            background: linear-gradient(135deg, rgba(96, 165, 250, 0.2) 0%, rgba(96, 165, 250, 0.1) 100%);
            border-color: rgba(96, 165, 250, 0.3);
            box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
        }

        .boxes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin: 30px 0;
            position: relative;
            padding: 20px;
            z-index: 7;
            flex-grow: 1;
        }

        .box {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            border: 3px solid #d97706;
            border-radius: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background-image: url('box_closed.png');
            background-size: cover;
            background-position: center;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            overflow: hidden;
            animation: floatAndGlow 4s infinite ease-in-out;
        }

        .box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 50%, rgba(0, 0, 0, 0.1) 100%);
            border-radius: 17px;
            pointer-events: none;
        }

        @keyframes floatAndGlow {
            0% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            25% { 
                transform: translateY(-8px) scale(1.03); 
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            50% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            75% { 
                transform: translateY(8px) scale(1.03); 
                box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            100% { 
                transform: translateY(0px) scale(1); 
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
        }

        .box:hover:not(.opened) {
            transform: translateY(-12px) scale(1.07);
            animation: none;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
        }

        .box.opened {
            background-image: none;
            transform: scale(0.95);
            animation: none !important;
            cursor: default;
        }

        /* Styles for opened boxes with different results */
        .box.opened.win {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 3px solid #047857;
            box-shadow: 0 0 20px 8px rgba(16, 185, 129, 0.6);
        }

        .box.opened.lose {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 3px solid #b91c1c;
            box-shadow: 0 0 20px 8px rgba(239, 68, 68, 0.6);
        }

        .box.opened.neutral {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            border: 3px solid #374151;
            box-shadow: 0 0 20px 8px rgba(107, 114, 128, 0.6);
        }

        .box-content {
            text-align: center;
            z-index: 2;
            position: relative;
        }

        .box-text {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .coin-icon {
            width: 90px;
            height: 60px;
            background-image: url('coin.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            display: none;
            margin: 8px auto 0;
            animation: coinGlow 2s infinite alternate;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            z-index: 8;
        }

        .bet-button {
            padding: 18px 35px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            border: none;
            border-radius: 15px;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            justify-content: center;
        }

        .bet-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .bet-button:hover::before {
            left: 100%;
        }

        .bet-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .bet-button:active {
            transform: translateY(-1px);
        }

        .bet-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .bet-button:disabled:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        #single-shot-button { 
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        #single-shot-button:hover {
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.6);
        }
        
        #triple-shot-button { 
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }
        
        #triple-shot-button:hover {
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.6);
        }
        
        #hammer-shot-button { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        #hammer-shot-button:hover {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }

        #seeker-hero {
            position: absolute;
            width: 90px;
            height: 90px;
            background-image: url('hero.png');
            background-size: contain;
            background-repeat: no-repeat;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translate(-50%, -50%);
            z-index: 20;
            display: none;
            filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
        }

        @keyframes coinGlow {
            0% {
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8)) brightness(1);
                transform: scale(1);
            }
            50% {
                filter: drop-shadow(0 0 20px rgba(255, 215, 0, 1)) brightness(1.2);
                transform: scale(1.05);
            }
            100% {
                filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8)) brightness(1);
                transform: scale(1);
            }
        }

        @keyframes finalSeekerPulse {
            0% { 
                transform: translate(-50%, -50%) scale(1);
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
            }
            50% {
                transform: translate(-50%, -50%) scale(1.3);
                filter: drop-shadow(0 0 25px rgba(255, 255, 255, 1));
            }
            100% { 
                transform: translate(-50%, -50%) scale(1);
                filter: drop-shadow(0 0 15px rgba(255, 255, 255, 0.8));
            }
        }

        @keyframes sequentialGlow {
            0% { 
                box-shadow: 0 0 20px 10px rgba(255, 255, 0, 0.6);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 30px 15px rgba(255, 255, 0, 0.9);
                transform: scale(1.1);
            }
            100% { 
                box-shadow: 0 0 20px 10px rgba(255, 255, 0, 0.6);
                transform: scale(1);
            }
        }

        .sequential-glow {
            animation: sequentialGlow 0.6s ease-in-out;
        }

        @keyframes finalGlow {
            0% { 
                box-shadow: 0 0 20px 10px rgba(0, 255, 0, 0.7);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px 20px rgba(0, 255, 0, 1);
                transform: scale(1.15);
            }
            100% { 
                box-shadow: 0 0 20px 10px rgba(0, 255, 0, 0.7);
                transform: scale(1);
            }
        }

        .single-shot-final-glow {
            animation: finalGlow 1.2s infinite alternate;
        }

        #loading-indicator {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.6) 100%);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.2em;
            font-weight: bold;
            z-index: 1000;
            display: none;
            backdrop-filter: blur(10px);
        }

        /* Chat Window Styles */
        .chat-container {
            position: sticky;
            top: 120px;
            width: 380px;
            height: 600px;
            flex-shrink: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            z-index: 50;
            transition: all 0.3s ease;
        }

        .chat-container.collapsed {
            width: 70px;
            overflow: hidden;
        }

        .chat-container.collapsed .chat-messages,
        .chat-container.collapsed .chat-input-container,
        .chat-container.collapsed .chat-header h3,
        .chat-container.collapsed #voiceChatBtn,
        .chat-container.collapsed #chatMuteBtn {
            display: none;
        }

        .chat-container.collapsed .chat-header {
            justify-content: center;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.3) 0%, rgba(52, 152, 219, 0.1) 100%);
            border-radius: 18px 18px 0 0;
        }

        .chat-header h3 {
            margin: 0;
            color: #fff;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .chat-control-btn,
        .chat-toggle-btn {
            border: none;
            color: #fff;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.2), 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .chat-control-btn:hover,
        .chat-toggle-btn:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        /* Specific Button Colors */
        #voiceChatBtn {
            background: linear-gradient(135deg, #3b82f6, #6366f1); /* Blue/Indigo */
        }

        #chatMuteBtn {
            background: linear-gradient(135deg, #f97316, #ea580c); /* Orange/Red */
        }

        #toggleChat {
            background: linear-gradient(135deg, #6b7280, #4b5563); /* Cool Gray */
        }
        
        /* State-based colors */
        .chat-control-btn.muted {
            background: linear-gradient(135deg, #ef4444, #b91c1c); /* Vibrant Red for Mute */
            color: #fff; /* Ensure icon color is white */
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
        }

        .chat-message {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 12px 18px;
            border-radius: 18px;
            max-width: 85%;
            word-wrap: break-word;
        }

        .chat-message.own {
            align-self: flex-end;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.8) 0%, rgba(52, 152, 219, 0.6) 100%);
            color: #fff;
        }

        .chat-message.other {
            align-self: flex-start;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .system-message {
            align-self: center;
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.3) 0%, rgba(255, 193, 7, 0.1) 100%);
            color: #fff;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            text-align: center;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .message-sender {
            font-size: 0.85em;
            font-weight: bold;
            opacity: 0.8;
        }

        .message-text {
            font-size: 1em;
            line-height: 1.5;
        }

        .message-time {
            font-size: 0.75em;
            opacity: 0.6;
            align-self: flex-end;
        }

        .chat-input-container {
            display: flex;
            gap: 12px;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0 0 18px 18px;
        }

        #chatInput {
            flex: 1;
            padding: 12px 18px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 1em;
            outline: none;
            transition: all 0.3s ease;
        }

        #chatInput::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        #chatInput:focus {
            border-color: rgba(52, 152, 219, 0.8);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .chat-controls-row {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .emoji-btn,
        .sound-btn {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 35px;
            height: 35px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.1em;
        }

        .emoji-btn:hover,
        .sound-btn:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.4) 0%, rgba(255, 255, 255, 0.2) 100%);
            transform: scale(1.1);
        }

        .emoji-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            display: none;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .emoji-picker.show {
            display: grid;
        }

        .emoji-item {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 1.2em;
        }

        .emoji-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.2);
        }

        .sound-keys {
            position: absolute;
            bottom: 100%;
            left: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .sound-keys.show {
            display: flex;
        }

        .sound-key {
            padding: 8px 12px;
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.3) 0%, rgba(52, 152, 219, 0.1) 100%);
            border: 1px solid rgba(52, 152, 219, 0.3);
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9em;
            text-align: center;
        }

        .sound-key:hover {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.5) 0%, rgba(52, 152, 219, 0.3) 100%);
            transform: scale(1.05);
        }

        .send-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 50%, #1f618d 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            box-shadow: 
                0 4px 15px rgba(52, 152, 219, 0.4),
                inset 0 1px 2px rgba(255, 255, 255, 0.2),
                0 2px 8px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            animation: sendButtonGlow 3s ease-in-out infinite;
        }

        .send-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .send-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.3s ease;
        }

        .send-btn:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 
                0 8px 25px rgba(52, 152, 219, 0.6),
                inset 0 1px 3px rgba(255, 255, 255, 0.3),
                0 4px 15px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #5dade2 0%, #3498db 50%, #2980b9 100%);
            border-color: rgba(255, 255, 255, 0.5);
            animation: sendButtonPulse 0.8s ease-in-out infinite;
        }

        .send-btn:hover::before {
            left: 100%;
        }

        .send-btn:hover::after {
            width: 100%;
            height: 100%;
        }

        .send-btn:active {
            transform: scale(0.95) rotate(0deg);
            box-shadow: 
                0 2px 10px rgba(52, 152, 219, 0.4),
                inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            box-shadow: none;
            animation: none;
        }

        .send-btn:disabled::before,
        .send-btn:disabled::after {
            display: none;
        }

        @keyframes sendButtonGlow {
            0%, 100% { 
                box-shadow: 
                    0 4px 15px rgba(52, 152, 219, 0.4),
                    inset 0 1px 2px rgba(255, 255, 255, 0.2),
                    0 2px 8px rgba(0, 0, 0, 0.2);
            }
            50% { 
                box-shadow: 
                    0 6px 20px rgba(52, 152, 219, 0.6),
                    inset 0 1px 2px rgba(255, 255, 255, 0.2),
                    0 2px 8px rgba(0, 0, 0, 0.2);
            }
        }

        @keyframes sendButtonPulse {
            0%, 100% { 
                transform: scale(1.15) rotate(5deg);
            }
            50% { 
                transform: scale(1.2) rotate(5deg);
            }
        }

        /* Item Collection Display */
        .item-collection-display {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .item-collection-title {
            color: #fff;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }

        .item-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .item-display.negative {
            border-color: rgba(239, 68, 68, 0.6);
            background: rgba(239, 68, 68, 0.1);
            animation: negativeItemPulse 2s infinite;
        }

        @keyframes negativeItemPulse {
            0%, 100% { 
                border-color: rgba(239, 68, 68, 0.6);
                box-shadow: 0 0 5px rgba(239, 68, 68, 0.3);
            }
            50% { 
                border-color: rgba(239, 68, 68, 0.9);
                box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
            }
        }

        @keyframes negativeItemShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .item-display:hover {
            transform: scale(1.05);
            background: rgba(255, 255, 255, 0.2);
        }

        .item-display.negative:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        .item-emoji {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .item-count {
            color: #fff;
            font-size: 0.9em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .item-progress {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }

        .item-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            border-radius: 2px;
            transition: width 0.5s ease;
        }

        .collection-reward {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            animation: collectionRewardGlow 2s infinite alternate;
        }

        @keyframes collectionRewardGlow {
            0% { box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); }
            100% { box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6); }
        }

        /* Item Found Animation */
        .item-found {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 3px solid;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            z-index: 1000;
            animation: itemFoundPop 0.6s ease-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .item-found.positive {
            border-color: #10b981;
            color: #10b981;
        }

        .item-found.negative {
            border-color: #ef4444;
            color: #ef4444;
        }

        .item-found-emoji {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .item-found-text {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .item-found-points {
            font-size: 1.1em;
            opacity: 0.8;
        }

        @keyframes itemFoundPop {
            0% { 
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.1);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        /* Item Info Modal */
        .item-info-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .item-info-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .item-info-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            color: #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .item-info-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .item-info-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #3498db;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .item-info-close {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            border: none;
            color: #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
        }

        .item-info-close:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }

        .item-info-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 25px;
        }

        .item-info-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .item-info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .item-info-emoji {
            font-size: 2.5em;
            min-width: 60px;
            text-align: center;
        }

        .item-info-details {
            flex: 1;
        }

        .item-info-name {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 8px;
            color: #fff;
        }

        .item-info-description {
            font-size: 1em;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .item-info-points {
            font-size: 1.1em;
            font-weight: bold;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .item-info-points.positive {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: #fff;
        }

        .item-info-points.negative {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: #fff;
        }

        .collection-goals-section {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 215, 0, 0.1) 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .collection-goals-title {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .collection-goals-list {
            display: grid;
            gap: 10px;
        }

        .collection-goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .collection-goal-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .collection-goal-emoji {
            font-size: 1.5em;
        }

        .collection-goal-text {
            font-size: 1em;
            color: #fff;
        }

        .collection-goal-reward {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #000;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9em;
        }

        /* Info Button */
        .item-info-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 45px;
            height: 45px;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
            position: relative;
            overflow: hidden;
        }

        .item-info-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s ease;
        }

        .item-info-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.6);
        }

        .item-info-btn:hover::before {
            left: 100%;
        }

        #effect-overlay {
          position: fixed;
          top: 0; left: 0;
          width: 100vw; height: 100vh;
          background: rgba(0,0,0,0.7);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
          flex-direction: column;
        }
        #effect-overlay img {
          max-width: 80vw;
          max-height: 80vh;
          border-radius: 20px;
          box-shadow: 0 0 40px #fff8;
        }
    </style>
</head>
<body>
    <div class="main-content">
        <div class="game-container">
            <div class="header-container">
                <div class="centered-header-content">
                    <img src="logo.png" alt="ÿ¥ÿπÿßÿ± ÿßŸÑŸÑÿπÿ®ÿ©" class="logo">
                    <h1 class="game-title">Voice Boom</h1>
                </div>
            </div>
            <div class="message-area" id="message-area"></div>
            
            <div class="controls">
                <button id="single-shot-button" class="bet-button">
                    <i class="fas fa-crosshairs"></i>
                    ÿ∂ÿ±ÿ®ÿ© ŸÅÿ±ÿØŸäÿ© (100)
                </button>
                <button id="triple-shot-button" class="bet-button">
                    <i class="fas fa-bullseye"></i>
                    ÿ∂ÿ±ÿ®ÿ© ÿ´ŸÑÿßÿ´Ÿäÿ© (300)
                </button>
                <button id="hammer-shot-button" class="bet-button">
                    <i class="fas fa-hammer"></i>
                    ÿ∂ÿ±ÿ®ÿ© ÿßŸÑŸÖÿ∑ÿ±ŸÇÿ© (500)
                </button>
            </div>
            
            <!-- Item Collection Display -->
            <div class="item-collection-display" id="itemCollectionDisplay">
                <div class="item-collection-title">
                    üéØ ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿ¨ŸÖÿπÿ©
                    <button id="itemInfoBtn" class="item-info-btn" title="ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿπŸÜÿßÿµÿ±">
                        <i class="fas fa-info-circle"></i>
                    </button>
                </div>
                <div class="items-grid" id="itemsGrid">
                    <!-- Items will be generated by JavaScript -->
                </div>
                <div class="collection-reward" id="collectionReward" style="display: none;">
                    üéâ ŸÖŸÉÿßŸÅÿ£ÿ© ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿ©!
                </div>
            </div>
            
            <div class="boxes-grid" id="boxes-container">
                <!-- Boxes will be generated by JavaScript -->
            </div>
            <div id="seeker-hero"></div>
        </div>
    </div>
    
    <div class="right-panel">
    <div class="player-info">
        <div class="player-details">
            <p><span id="username-display"></span></p>
            <p><span id="balance-display"></span>üí∞</p>
        </div>
        <div class="player-actions">
            <button id="recharge-button" title="ÿ™ÿπÿ®ÿ¶ÿ© ÿ±ÿµŸäÿØ">üí∞</button>
            <button id="logout-button" title="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨">‚èª</button>
            <button id="mute-button" title="ŸÉÿ™ŸÖ/ÿ•ŸÑÿ∫ÿßÿ° ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™">üîä</button>
        </div>
    </div>
        <!-- Chat Window -->
        <div class="chat-container" id="chatContainer">
            <div class="chat-header">
                <h3><i class="fas fa-comments"></i> ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©</h3>
                <div class="chat-controls">
                    <button id="reconnectBtn" class="chat-control-btn" title="ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <i class="fas fa-wifi"></i>
                    </button>
                    <button id="voiceChatBtn" class="chat-control-btn" title="ÿ®ÿØÿ° ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©">
                        <i class="fas fa-microphone-slash"></i>
                    </button>
                    <button id="chatMuteBtn" class="chat-control-btn" title="ŸÉÿ™ŸÖ ÿµŸàÿ™ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">
                        <i class="fas fa-volume-up"></i>
                    </button>
                    <button id="toggleChat" class="chat-toggle-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
            </div>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="system-message">
                    <span class="message-time">ÿßŸÑÿ¢ŸÜ</span>
                    <span class="message-text">ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿ™ÿ≠ÿØÿ´ ŸÖÿπ ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ÿßŸÑÿ¢ÿÆÿ±ŸäŸÜ ŸáŸÜÿß</span>
                </div>
            </div>
            <div class="chat-input-container">
                <div class="chat-controls-row" style="position: relative;">
                    <button id="emojiBtn" class="emoji-btn" title="ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÖÿ≤ ÿ™ÿπÿ®Ÿäÿ±Ÿä">
                        üòä
                    </button>
                    <div id="emojiPicker" class="emoji-picker">
                        <div class="emoji-item">üòä</div>
                        <div class="emoji-item">üòÇ</div>
                        <div class="emoji-item">üéâ</div>
                        <div class="emoji-item">üèÜ</div>
                        <div class="emoji-item">üí∞</div>
                        <div class="emoji-item">üéÆ</div>
                        <div class="emoji-item">üî•</div>
                        <div class="emoji-item">‚≠ê</div>
                        <div class="emoji-item">üí™</div>
                        <div class="emoji-item">üéØ</div>
                        <div class="emoji-item">üéä</div>
                        <div class="emoji-item">ü•≥</div>
                        <div class="emoji-item">üòç</div>
                        <div class="emoji-item">ü§©</div>
                        <div class="emoji-item">üëè</div>
                        <div class="emoji-item">üé™</div>
                        <div class="emoji-item">üé®</div>
                        <div class="emoji-item">üåü</div>
                        <div class="emoji-item">‚ú®</div>
                        <div class="emoji-item">ü¶™</div>
                        <div class="emoji-item">üé≠</div>
                        <div class="emoji-item">üé™</div>
                        <div class="emoji-item">üéØ</div>
        </div>
    </div>

                <div class="chat-controls-row" style="position: relative;">
                    <button id="soundBtn" class="sound-btn" title="ŸÖŸÅÿßÿ™Ÿäÿ≠ ÿßŸÑÿµŸàÿ™">
                        üîä
                    </button>
                    <div id="soundKeys" class="sound-keys">
                        <div class="sound-key" data-sound="win">üéâ ŸÅŸàÿ≤</div>
                        <div class="sound-key" data-sound="lose">üò¢ ÿÆÿ≥ÿßÿ±ÿ©</div>
                        <div class="sound-key" data-sound="click">üëÜ ŸÜŸÇÿ±ÿ©</div>
                        <div class="sound-key" data-sound="single">üéØ ÿ∂ÿ±ÿ®ÿ© ŸÅÿ±ÿØŸäÿ©</div>
                        <div class="sound-key" data-sound="triple">üéØ ÿ∂ÿ±ÿ®ÿ© ÿ´ŸÑÿßÿ´Ÿäÿ©</div>
                        <div class="sound-key" data-sound="hammer">üî® ÿ∂ÿ±ÿ®ÿ© ÿßŸÑŸÖÿ∑ÿ±ŸÇÿ©</div>
            </div>
            </div>
                
                <input type="text" id="chatInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß..." maxlength="100">
                <button id="sendMessage" class="send-btn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="loading-indicator">ÿ¨ÿßÿ±Ÿä ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</div>

    <!-- Voice Chat Modal -->
    <div class="voice-modal" id="voiceModal">
        <div class="voice-modal-content">
            <h3><i class="fas fa-microphone"></i> ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©</h3>
            <p>ŸÑÿ®ÿØÿ° ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©ÿå ŸÜÿ≠ÿ™ÿßÿ¨ ÿ•ŸÑŸâ ÿ•ÿ∞ŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖÿßŸäŸÉÿ±ŸàŸÅŸàŸÜ</p>
            <button id="enableVoiceBtn" class="voice-permission-btn">
                <i class="fas fa-microphone"></i> ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖÿßŸäŸÉÿ±ŸàŸÅŸàŸÜ
            </button>
            <button id="cancelVoiceBtn" class="voice-permission-btn" style="background: #6b7280;">
                ÿ•ŸÑÿ∫ÿßÿ°
            </button>
        </div>
    </div>

    <div id="win-gif-container">
        <button class="close-btn" id="closeWinGif">√ó</button>
        <img src="WIN.GIF" alt="Win GIF">
        <div id="win-amount-display" style="display: none;">
            <span id="win-amount-text"></span>
        </div>
    </div>

    <div id="sadcat-gif-container">
        <button class="close-btn" id="closeSadcatGif">√ó</button>
        <img src="sadcat.gif" alt="Sadcat GIF">
        <div id="lose-amount-display" style="display: none;">
            <span id="lose-amount-text"></span>
        </div>
    </div>

    <audio id="winSound" src="win.mp3"></audio>
    <audio id="loseSound" src="lose.mp3"></audio>
    <audio id="buttonClick" src="click.mp3"></audio>
    <audio id="winGifSound" src="WIN1.MP3"></audio>
    <audio id="loseGifSound" src="LOOS.MP3"></audio>
    
    <!-- Chat Audio -->
    <audio id="chatNotification" src="sounds/click.mp3"></audio>
    <audio id="messageSent" src="click.mp3"></audio>

    <!-- Item Info Modal -->
    <div class="item-info-modal" id="itemInfoModal">
        <div class="item-info-content">
            <div class="item-info-header">
                <h2 class="item-info-title">üìö ÿØŸÑŸäŸÑ ÿßŸÑÿπŸÜÿßÿµÿ±</h2>
                <button class="item-info-close" id="itemInfoClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="item-info-grid" id="itemInfoGrid">
                <!-- Items will be generated by JavaScript -->
            </div>
            
            <div class="collection-goals-section">
                <h3 class="collection-goals-title">üéØ ÿ£ŸáÿØÿßŸÅ ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™</h3>
                <div class="collection-goals-list" id="collectionGoalsList">
                    <!-- Goals will be generated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Overlay for win/lose effects -->
    <div id="effect-overlay" style="display:none;">
      <button id="effect-close-btn" style="position:absolute;top:30px;right:40px;font-size:2.2em;background:rgba(0,0,0,0.3);color:#fff;border:none;border-radius:50%;width:48px;height:48px;cursor:pointer;z-index:10001;">&times;</button>
      <img id="effect-image" src="" alt="effect" />
      <audio id="effect-audio"></audio>
    </div>

    <script>
        const BACKEND_URL = 'https://mygame25bita-7eqw.onrender.com';

        // Game State
        let score = 0;
        let highScore = 0;
        let roundNumber = 1;
        let username = '';
        let isProcessingShot = false;
        
        // Item Collection System
        let collectedGems = 0;
        let totalGemsCollected = 0;
        let batsHit = 0;
        let itemsCollected = {
            gem: 0,
            key: 0,
            coin: 0,
            bomb: 0,
            star: 0,
            bat: 0
        };
        
        // Item Rewards Configuration
        const ITEM_REWARDS = {
            gem: { points: 75, name: 'ŸÑÿ§ŸÑÿ§ÿ©', emoji: 'ü¶™', color: '#ff69b4' },      // Increased from 50
            key: { points: 150, name: 'ŸÖŸÅÿ™ÿßÿ≠', emoji: 'üîë', color: '#ffd700' },     // Increased from 100
            coin: { points: 40, name: 'ÿπŸÖŸÑÿ©', emoji: 'ü™ô', color: '#ffd700' },      // Increased from 25
            bomb: { points: -50, name: 'ŸÇŸÜÿ®ŸÑÿ©', emoji: 'üí£', color: '#ff4500' },    // Reduced from -100
            star: { points: 300, name: 'ŸÜÿ¨ŸÖÿ©', emoji: '‚≠ê', color: '#ffd700' },     // Increased from 200
            bat: { points: -75, name: 'ÿÆŸÅÿßÿ¥', emoji: 'ü¶á', color: '#8b4513' }      // Reduced from -250
        };
        
        // Collection Goals
        const COLLECTION_GOALS = {
            gem: { target: 5, reward: 1500, name: 'ÿßŸÑÿ¨ŸàÿßŸáÿ±' },    // Increased from 1000
            key: { target: 3, reward: 800, name: 'ÿßŸÑŸÖŸÅÿßÿ™Ÿäÿ≠' },    // Increased from 500
            star: { target: 2, reward: 1200, name: 'ÿßŸÑŸÜÿ¨ŸàŸÖ' }     // Increased from 800
        };

        // DOM Elements
        const usernameDisplay = document.getElementById('username-display');
        const balanceDisplay = document.getElementById('balance-display');
        const boxesContainer = document.getElementById('boxes-container');
        const messageArea = document.getElementById('message-area');
        const singleShotButton = document.getElementById('single-shot-button');
        const tripleShotButton = document.getElementById('triple-shot-button');
        const hammerShotButton = document.getElementById('hammer-shot-button');
        const logoutButton = document.getElementById('logout-button');
        const seekerImage = document.getElementById('seeker-hero');
        const loadingIndicator = document.getElementById('loading-indicator');
        const rechargeButton = document.getElementById('recharge-button');
        const muteButton = document.getElementById('mute-button');

        // Sound Effects
        const sounds = {
            win: new Audio('win.mp3'),
            lose: new Audio('lose.mp3'),
            buttonClick: new Audio('click.mp3'),
            singleShot: new Audio('ÿ∂ÿ±ÿ®ÿ© ŸÅÿ±ÿØŸäÿ©.mp3'),
            tripleShot: new Audio('ÿ∂ÿ±ÿ®ÿ© ÿ´ŸÑÿßÿ´Ÿäÿ© .mp3'), // Corrected filename with space
            hammerShot: new Audio('hammerShot.mp3'),
            winGif: new Audio('WIN1.MP3'),
            loseGif: new Audio('LOOS.MP3')
        };

        // Check if audio files exist
        function checkAudioFiles() {
            Object.entries(sounds).forEach(([name, audio]) => {
                audio.addEventListener('error', (e) => {
                    console.error(`Audio file error for ${name}:`, e);
                });
                audio.addEventListener('loadstart', () => {
                    console.log(`Audio file ${name} loading started`);
                });
                audio.addEventListener('canplay', () => {
                    console.log(`Audio file ${name} ready to play`);
                });
            });
        }

        let isMuted = false;
        let isChatMuted = false; // New variable for chat sounds
        let chatVolume = 0.5; // Chat volume level

        const BETS = {
            single: { cost: 100, multiplier: 2.5 },   // Increased from 2.0
            triple: { cost: 300, multiplier: 3.0 },   // Increased from 2.5
            hammer: { cost: 500, multiplier: 4.0 }    // Increased from 3.0
        };

        // Utility Functions
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showMessage(message, type = 'info') {
            messageArea.textContent = message;
            messageArea.className = 'message-area ' + type;
        }

        // Item Management Functions
        function initializeItemDisplay() {
            const itemsGrid = document.getElementById('itemsGrid');
            itemsGrid.innerHTML = '';
            
            // Create display for each item type
            const itemTypes = ['gem', 'key', 'coin', 'bomb', 'star', 'bat'];
            
            itemTypes.forEach(itemType => {
                const itemData = ITEM_REWARDS[itemType];
                const itemDisplay = document.createElement('div');
                itemDisplay.className = 'item-display';
                
                // Add negative class for items with negative points
                if (itemData.points < 0) {
                    itemDisplay.classList.add('negative');
                }
                
                itemDisplay.dataset.itemType = itemType;
                
                // Get current count
                const currentCount = itemsCollected[itemType] || 0;
                
                // Calculate progress for collection goals
                let progress = 0;
                let targetText = '';
                if (COLLECTION_GOALS[itemType]) {
                    const goal = COLLECTION_GOALS[itemType];
                    progress = Math.min((currentCount / goal.target) * 100, 100);
                    targetText = `${currentCount}/${goal.target}`;
                } else {
                    targetText = currentCount.toString();
                }
                
                itemDisplay.innerHTML = `
                    <div class="item-emoji">${itemData.emoji}</div>
                    <div class="item-count">${targetText}</div>
                    <div class="item-progress">
                        <div class="item-progress-bar" style="width: ${progress}%"></div>
                    </div>
                `;
                
                itemsGrid.appendChild(itemDisplay);
            });
        }

        function updateItemDisplay() {
            Object.entries(itemsCollected).forEach(([itemType, count]) => {
                const itemDisplay = document.querySelector(`[data-item-type="${itemType}"]`);
                if (itemDisplay) {
                    const countElement = itemDisplay.querySelector('.item-count');
                    const progressBar = itemDisplay.querySelector('.item-progress-bar');
                    
                    // Update count text
                    if (COLLECTION_GOALS[itemType]) {
                        const goal = COLLECTION_GOALS[itemType];
                        countElement.textContent = `${count}/${goal.target}`;
                    } else {
                        countElement.textContent = count.toString();
                    }
                    
                    // Update progress bar for collection goals
                    if (COLLECTION_GOALS[itemType]) {
                        const goal = COLLECTION_GOALS[itemType];
                        const progress = Math.min((count / goal.target) * 100, 100);
                        progressBar.style.width = `${progress}%`;
                    }
                }
            });
        }

        function addItem(itemType) {
            if (itemsCollected[itemType] !== undefined) {
                itemsCollected[itemType]++;
                updateItemDisplay();
                
                // Check for collection rewards
                checkCollectionRewards(itemType);
                
                // Show item found animation
                showItemFound(itemType);
                
                // Update score
                const itemData = ITEM_REWARDS[itemType];
                if (itemData) {
                    score += itemData.points;
                    updateDisplay();
                    
                    // Play sound for negative items
                    if (itemData.points < 0) {
                        sounds.lose.play().catch(e => console.log('Negative item sound error:', e));
                    }
                    
                    // Show in chat area
                    const pointsText = itemData.points > 0 ? `+${itemData.points}` : `${itemData.points}`;
                    addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', `${itemData.emoji} ŸÑŸÇÿØ ÿ≠ÿµŸÑÿ™ ÿπŸÑŸâ <b>${itemData.name}</b> (${pointsText} ŸÜŸÇÿ∑ÿ©)`, itemData.points > 0 ? 'system-message' : 'system-message error');
                }
                
                // Save data to server
                saveUserData();
            }
        }

        function showItemFound(itemType) {
            const itemData = ITEM_REWARDS[itemType];
            if (!itemData) return;
            
            const itemFound = document.createElement('div');
            itemFound.className = `item-found ${itemData.points >= 0 ? 'positive' : 'negative'}`;
            
            itemFound.innerHTML = `
                <div class="item-found-emoji">${itemData.emoji}</div>
                <div class="item-found-text">${itemData.name}</div>
                <div class="item-found-points">${itemData.points >= 0 ? '+' : ''}${itemData.points} ŸÜŸÇÿ∑ÿ©</div>
            `;
            
            document.body.appendChild(itemFound);
            
            // Remove after animation
            setTimeout(() => {
                itemFound.remove();
            }, 2000);
        }

        function checkCollectionRewards(itemType) {
            const goal = COLLECTION_GOALS[itemType];
            if (!goal) return;
            
            if (itemsCollected[itemType] >= goal.target) {
                // Award collection bonus
                score += goal.reward;
                updateDisplay();
                
                // Show collection reward
                const rewardElement = document.getElementById('collectionReward');
                rewardElement.textContent = `üéâ ŸÖŸÉÿßŸÅÿ£ÿ© ${goal.name}: +${goal.reward} ŸÜŸÇÿ∑ÿ©!`;
                rewardElement.style.display = 'block';
                
                // Hide after 3 seconds
                setTimeout(() => {
                    rewardElement.style.display = 'none';
                }, 3000);
                
                // Reset collection count
                itemsCollected[itemType] = 0;
                updateItemDisplay();
                
                // Save data
                saveUserData();
            }
        }

        function generateRandomItem() {
            const itemTypes = Object.keys(ITEM_REWARDS);
            const weights = {
                gem: 20,      // 20% chance (increased from 15%)
                key: 15,      // 15% chance (increased from 10%)
                coin: 30,     // 30% chance (increased from 25%)
                bomb: 12,     // 12% chance (reduced from 20%)
                star: 12,     // 12% chance (increased from 8%)
                bat: 11       // 11% chance (reduced from 22%)
            };
            
            const totalWeight = Object.values(weights).reduce((sum, weight) => sum + weight, 0);
            let random = Math.random() * totalWeight;
            
            for (const [itemType, weight] of Object.entries(weights)) {
                random -= weight;
                if (random <= 0) {
                    return itemType;
                }
            }
            
            return 'coin'; // Default fallback
        }

        function updateDisplay() {
            balanceDisplay.textContent = Math.round(score);
            usernameDisplay.textContent = username;

            // Disable buttons only if a shot is currently being processed
            const buttonsDisabled = isProcessingShot;
            singleShotButton.disabled = buttonsDisabled;
            tripleShotButton.disabled = buttonsDisabled;
            hammerShotButton.disabled = buttonsDisabled;
        }

        function createHero() {
            const hero = document.createElement('div');
            hero.id = 'hero';
            hero.textContent = 'C'; // Use text content 'C'
            hero.style.fontSize = '24px'; // Adjust size as needed
            hero.style.color = 'white'; // Set color
            hero.style.display = 'flex';
            hero.style.alignItems = 'center';
            hero.style.justifyContent = 'center';
            hero.style.fontWeight = 'bold';
            return hero;
        }

        function createBoxes(count = 10) {
            boxesContainer.innerHTML = '';
            for (let i = 0; i < count; i++) {
                const box = document.createElement('div');
                box.classList.add('box');
                box.dataset.id = i;

                const boxContent = document.createElement('div');
                boxContent.classList.add('box-content');

                const boxText = document.createElement('div');
                boxText.classList.add('box-text');

                const itemIcon = document.createElement('div');
                itemIcon.classList.add('item-icon');
                itemIcon.style.display = 'none'; // Hidden by default

                const coinIcon = document.createElement('div');
                coinIcon.classList.add('coin-icon');

                boxContent.appendChild(boxText);
                boxContent.appendChild(itemIcon);
                boxContent.appendChild(coinIcon);
                box.appendChild(boxContent);
                boxesContainer.appendChild(box);
            }
        }

        async function loadGameData() {
            try {
                const response = await fetch(`${BACKEND_URL}/api/users/me`, {
                    headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
                });
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('token');
                        window.location.href = 'index.html';
                    }
                    throw new Error('Failed to load game data');
                }
                const data = await response.json();
                score = data.score || 1000;
                highScore = data.highScore || score;
                roundNumber = data.roundNumber || 1;
                if (data.itemsCollected) itemsCollected = { ...itemsCollected, ...data.itemsCollected };
                if (data.collectedGems !== undefined) collectedGems = data.collectedGems;
                if (data.totalGemsCollected !== undefined) totalGemsCollected = data.totalGemsCollected;
                if (data.batsHit !== undefined) batsHit = data.batsHit;
                updateDisplay();
                updateItemDisplay();
            } catch (error) {
                console.error('Error loading game data:', error);
                showMessage('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©', 'error');
                score = 1000;
                highScore = 1000;
                roundNumber = 1;
                updateDisplay();
            }
        }

        async function saveUserData() {
            const token = localStorage.getItem('token');
            if (!token) {
                console.error('No token found, user is not logged in.');
                return; 
            }
            const dataToSave = { 
                score, 
                highScore, 
                roundNumber,
                itemsCollected,
                collectedGems,
                totalGemsCollected,
                batsHit
            };
            console.log('Attempting to save user data:', dataToSave);
            try {
                const response = await fetch(`${BACKEND_URL}/api/users/save-game-data`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(dataToSave)
                });
                if (!response.ok) {
                    if (response.status === 401 || response.status === 403) {
                        localStorage.removeItem('token');
                        localStorage.removeItem('username');
                        window.location.href = 'index.html';
                    }
                    throw new Error(`Server responded with ${response.status}`);
                }
                const data = await response.json();
                console.log('User data saved successfully.');
            } catch (error) {
                if (error.name === 'TypeError' && error.message === 'Failed to fetch') {
                    console.warn('Fetch was cancelled by page navigation. Beacon will save data.');
                } else {
                    console.error('Error saving game data:', error);
                    showMessage('‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÑÿπÿ®ÿ©', 'error');
                }
            }
        }

        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿπŸÜÿØ ŸÖÿ∫ÿßÿØÿ±ÿ© ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ sendBeacon
        window.addEventListener('beforeunload', (event) => {
            const token = localStorage.getItem('token');
            if (!token) return;
            const dataToSave = { 
                score, 
                highScore, 
                roundNumber,
                itemsCollected,
                collectedGems,
                totalGemsCollected,
                batsHit
            };
            // sendBeacon Ÿäÿ±ÿ≥ŸÑ Content-Type: text/plain ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäŸãÿßÿå ŸÑÿ∞ÿß ŸÜÿ≥ÿ™ÿÆÿØŸÖ Blob ŸÖÿπ type json
            const blob = new Blob([JSON.stringify(dataToSave)], { type: 'application/json' });
            navigator.sendBeacon(`${BACKEND_URL}/api/users/save-game-data?token=${token}`, blob);
        });

        async function animateHeroAndOpenBox(betType) {
            const boxes = Array.from(document.querySelectorAll('.box:not(.opened)'));
            if (boxes.length === 0) {
                showMessage('ŸÉŸÑ ÿßŸÑÿµŸÜÿßÿØŸäŸÇ ŸÖŸÅÿ™Ÿàÿ≠ÿ©!', 'error');
                return null;
            }

            let boxesToOpenCount = 1;
            if (betType === 'triple') boxesToOpenCount = 3;
            if (betType === 'hammer') boxesToOpenCount = 5;

            if (boxes.length < boxesToOpenCount) {
                showMessage('ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿµŸÜÿßÿØŸäŸÇ ŸÉÿßŸÅŸäÿ© ŸÑŸáÿ∞Ÿá ÿßŸÑÿ∂ÿ±ÿ®ÿ©!', 'error');
                return null;
            }

            seekerImage.style.display = 'block';
            seekerImage.style.left = '50%';
            seekerImage.style.top = '110%';
            await sleep(200);

            const shuffledBoxes = boxes.sort(() => 0.5 - Math.random());
            const targets = shuffledBoxes.slice(0, boxesToOpenCount);

            for (let i = 0; i < shuffledBoxes.length; i++) {
                const box = shuffledBoxes[i];
                const boxRect = box.getBoundingClientRect();
                const gridRect = boxesContainer.getBoundingClientRect();
                const targetX = boxRect.left - gridRect.left + boxRect.width / 2;
                const targetY = boxRect.top - gridRect.top + boxRect.height / 2;

                seekerImage.style.left = `${targetX}px`;
                seekerImage.style.top = `${targetY}px`;

                box.classList.add('sequential-glow');
                await sleep(250);
                box.classList.remove('sequential-glow');

                if (targets.includes(box) && boxesToOpenCount > 1) {
                    box.classList.add('single-shot-final-glow');
                }
            }

            const finalTarget = targets[targets.length - 1];
            finalTarget.classList.add('single-shot-final-glow');
            seekerImage.style.animation = 'finalSeekerPulse 1s infinite alternate';

            await sleep(2000);

            seekerImage.style.animation = 'none';

            targets.forEach(box => {
                box.classList.remove('single-shot-final-glow');
                box.classList.add('opened');
            });

            return targets;
        }

        async function placeBet(betType) {
            if (isProcessingShot) return;

            const bet = BETS[betType];
            if (score < bet.cost) {
                showMessage('ÿ±ÿµŸäÿØŸÉ ŸÑÿß Ÿäÿ≥ŸÖÿ≠ ÿ®ÿßŸÑŸÖÿ±ÿßŸáŸÜÿ©. Ÿäÿ±ÿ¨Ÿâ ÿ¥ÿ≠ŸÜ ÿ±ÿµŸäÿØŸÉ.', 'error');
                const controls = document.querySelector('.controls');
                controls.innerHTML = '<button id="recharge-button" class="bet-button" style="background-color: #007bff;">ÿ¥ÿ≠ŸÜ ÿßŸÑÿ±ÿµŸäÿØ</button>';
                document.getElementById('recharge-button').addEventListener('click', () => {
                    window.location.href = 'index.html';
                });
                return;
            }

            // Play the correct sound for the bet type
            if (betType === 'single') {
                sounds.singleShot.play().catch(e => console.log('Single shot sound error:', e));
            } else if (betType === 'triple') {
                sounds.tripleShot.play().catch(e => console.log('Triple shot sound error:', e));
            } else if (betType === 'hammer') {
                sounds.hammerShot.play().catch(e => {
                    console.log('Hammer shot sound error:', e);
                    // Fallback to button click sound if hammer sound fails
                    sounds.buttonClick.play().catch(e2 => console.log('Button click fallback error:', e2));
                });
            }
            
            isProcessingShot = true;
            score -= bet.cost;
            updateDisplay();
            createBoxes();

            showMessage(`...${username} Ÿäÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿπŸÖŸÑÿßÿ™ ŸÅŸä ÿßŸÑÿµŸÜÿßÿØŸäŸÇ`, '');
            
            const openedBoxes = await animateHeroAndOpenBox(betType);

            if (!openedBoxes || openedBoxes.length === 0) {
                isProcessingShot = false;
                updateDisplay();
                return;
            }

            let totalWinAmount = 0;
            let wins = 0;

            openedBoxes.forEach((box, idx) => {
                const boxContent = box.querySelector('.box-content');
                const boxText = boxContent.querySelector('.box-text');
                const coinIcon = boxContent.querySelector('.coin-icon');
                const itemIcon = boxContent.querySelector('.item-icon');

                // Determine box type based on bet type
                let boxType = determineBoxType(betType);
                
                // Process box based on its type
                const result = processBox(boxType, bet, openedBoxes.length);
                
                // Update box display
                if (result.hasCoins) {
                    const winAmount = result.coinAmount;
                    totalWinAmount += winAmount;
                    score += winAmount;
                    boxText.textContent = `üí∞ ${Math.round(winAmount)}`;
                    coinIcon.style.display = 'block';
                    box.style.backgroundColor = '#28a745';
                    box.style.border = '3px solid #20c997';
                    wins++;
                    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ≠ÿØÿ´ ÿπÿ®ÿ± WebSocket
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({
                            type: 'box_opened',
                            username: username,
                            boxIndex: Array.from(document.querySelectorAll('.box')).indexOf(box),
                            result: 'win',
                            amount: Math.round(winAmount)
                        }));
                    }
                } else if (result.hasItem) {
                    const itemData = ITEM_REWARDS[result.item];
                    itemIcon.textContent = itemData.emoji;
                    itemIcon.style.display = 'block';
                    itemIcon.style.fontSize = '1.5em';
                    
                    if (itemData.points < 0) {
                        itemIcon.style.animation = 'negativeItemShake 0.5s ease-in-out';
                        itemIcon.style.filter = 'drop-shadow(0 0 10px #ef4444)';
                        sounds.lose.play().catch(e => console.log('Negative item appearance sound error:', e));
                    }
                    addItem(result.item);
                    const pointsText = itemData.points >= 0 ? `+${itemData.points}` : `${itemData.points}`;
                    boxText.textContent = `${itemData.emoji} ${pointsText}`;
                    boxText.style.color = itemData.points >= 0 ? '#fff' : '#ff6b6b';
                    box.style.backgroundColor = itemData.points >= 0 ? '#17a2b8' : '#dc3545';
                    box.style.border = itemData.points >= 0 ? '3px solid #20c997' : '3px solid #ff6b6b';
                    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ≠ÿØÿ´ ÿπÿ®ÿ± WebSocket
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({
                            type: 'box_opened',
                            username: username,
                            boxIndex: Array.from(document.querySelectorAll('.box')).indexOf(box),
                            result: 'item',
                            item: result.item,
                            points: itemData.points
                        }));
                    }
                } else {
                    boxText.textContent = 'üì¶ ŸÅÿßÿ±ÿ∫';
                    boxText.style.color = '#6c757d';
                    coinIcon.style.display = 'none';
                    itemIcon.style.display = 'none';
                    box.style.backgroundColor = '#6c757d';
                    box.style.border = '3px solid #495057';
                    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ≠ÿØÿ´ ÿπÿ®ÿ± WebSocket
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({
                            type: 'box_opened',
                            username: username,
                            boxIndex: Array.from(document.querySelectorAll('.box')).indexOf(box),
                            result: 'empty'
                        }));
                    }
                }
            });

            if (wins > 0) {
                showMessage(`ŸÖÿ®ÿ±ŸàŸÉ! ÿ±ÿ®ÿ≠ÿ™ ${Math.round(totalWinAmount)} ÿπŸÖŸÑÿ© ŸÖŸÜ ${wins} ÿµŸÜÿßÿØŸäŸÇ! üéâ`, 'success');
                sounds.win.play();

                showWinEffect(Math.round(totalWinAmount));
                sounds.winGif.currentTime = 0;
                sounds.winGif.play();
                setTimeout(() => {
                    sounds.winGif.pause();
                    sounds.winGif.currentTime = 0;
                }, 4000);
                // Send fake congratulatory messages
                setTimeout(() => {
                    sendFakeCongratulations(Math.round(totalWinAmount));
                }, 1000); // Start after 1 second
            } else {
                // Check if any items were found
                const itemsFound = openedBoxes.some(box => {
                    const itemIcon = box.querySelector('.item-icon');
                    return itemIcon && itemIcon.style.display === 'block';
                });
                
                if (itemsFound) {
                    showMessage('ŸÑŸÖ ÿ™ÿ±ÿ®ÿ≠ ÿπŸÖŸÑÿßÿ™ Ÿáÿ∞Ÿá ÿßŸÑŸÖÿ±ÿ©ÿå ŸÑŸÉŸÜŸÉ Ÿàÿ¨ÿØÿ™ ÿ®ÿπÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ±! üéÅ', 'info');
                } else {
                    showMessage('ÿ≠ÿ∏ ÿ£ŸàŸÅÿ± ŸÅŸä ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©! ÿ¨ÿ±ÿ® ÿ∂ÿ±ÿ®ÿ© ŸÖÿÆÿ™ŸÑŸÅÿ© üéØ', 'error');
                }
                
                sounds.lose.play();

                showLoseEffect(bet.cost);
                sounds.loseGif.currentTime = 0;
                sounds.loseGif.play();
                setTimeout(() => {
                    sounds.loseGif.pause();
                    sounds.loseGif.currentTime = 0;
                }, 3000);
                // Send fake loss reactions
                setTimeout(() => {
                    sendFakeLossReactions();
                }, 2000); // Start after 2 seconds
            }

            if (highScore < score) {
                highScore = score;
            }

            roundNumber++;
            updateDisplay();
            await saveUserData();

            isProcessingShot = false;
            updateDisplay(); // Re-enable buttons
        }

        // Event Listeners
        window.addEventListener('beforeunload', (event) => {
            if (isProcessingShot) {
                // Optionally, you can warn the user if they try to leave mid-game
                event.preventDefault();
                event.returnValue = '';
            } else {
                saveUserData();
            }
        });

        singleShotButton.addEventListener('click', () => placeBet('single'));
        tripleShotButton.addEventListener('click', () => placeBet('triple'));
        hammerShotButton.addEventListener('click', () => placeBet('hammer'));

        logoutButton.addEventListener('click', () => {
            sounds.buttonClick.play();
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            window.location.href = 'index.html';
        });

        rechargeButton.addEventListener('click', () => {
            sounds.buttonClick.play();
            window.location.href = 'index.html';
        });

        muteButton.addEventListener('click', () => {
            isMuted = !isMuted;
            Object.values(sounds).forEach(sound => sound.muted = isMuted);
            muteButton.textContent = isMuted ? 'üîá ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿ™ŸÖ' : 'üîä ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™';
        });

        // Chat functionality
        const chatContainer = document.getElementById('chatContainer');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendMessageBtn = document.getElementById('sendMessage');
        const toggleChatBtn = document.getElementById('toggleChat');
        const chatMuteBtn = document.getElementById('chatMuteBtn');
        const voiceChatBtn = document.getElementById('voiceChatBtn');
        const voiceChatStatus = document.getElementById('voiceChatStatus');
        const voiceModal = document.getElementById('voiceModal');
        const enableVoiceBtn = document.getElementById('enableVoiceBtn');
        const cancelVoiceBtn = document.getElementById('cancelVoiceBtn');
        const connectedPlayers = document.getElementById('connectedPlayers');

        // Emoji and Sound Keys
        const emojiBtn = document.getElementById('emojiBtn');
        const emojiPicker = document.getElementById('emojiPicker');
        const soundBtn = document.getElementById('soundBtn');
        const soundKeys = document.getElementById('soundKeys');

        // Chat audio elements
        const chatNotification = document.getElementById('chatNotification');
        const messageSent = document.getElementById('messageSent');

        let isChatCollapsed = false;
        let isVoiceChatActive = false;
        let mediaStream = null;
        let peerConnections = {};
        let ws; // WebSocket connection

        // Message deduplication
        const sentMessages = new Set();
        const messageTimeout = 5000; // 5 seconds

        function connectWebSocket() {
            try {
                // Use ws:// for local, and wss:// for secure production environment
                const wsUrl = window.location.protocol === 'https:'
                  ? 'wss://mygame25bita-7eqw.onrender.com'
                  : 'ws://localhost:3000';
                console.log('Attempting to connect to WebSocket:', wsUrl);
                
                ws = new WebSocket(wsUrl);

                ws.onopen = () => {
                    console.log('‚úÖ WebSocket connection established successfully');
                    addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ÿ™ŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿ®ŸÜÿ¨ÿßÿ≠.', 'system-message');
                    // Announce that this user has joined
                    if (username) {
                        ws.send(JSON.stringify({ type: 'join', username: username }));
                        console.log('Sent join message for user:', username);
                    }
                };

                ws.onmessage = (event) => {
                    if (typeof event.data === "string") {
                        try {
                            const data = JSON.parse(event.data);
                            handleWSData(data);
                        } catch (error) {
                            console.error('‚ùå Error parsing WebSocket message (string):', error, event.data);
                        }
                    } else if (event.data instanceof Blob) {
                        event.data.text().then(text => {
                            try {
                                const data = JSON.parse(text);
                                handleWSData(data);
                            } catch (error) {
                                console.error('‚ùå Error parsing WebSocket message (blob):', error, text);
                            }
                        });
                    }
                };

                ws.onclose = (event) => {
                    console.log('üîå WebSocket connection closed:', event.code, event.reason);
                    addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ÿßŸÜŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ. ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©...', 'system-message');
                    
                    // Try to reconnect after 3 seconds
                    setTimeout(() => {
                        console.log('üîÑ Attempting to reconnect WebSocket...');
                        connectWebSocket();
                    }, 3000);
                };

                ws.onerror = (error) => {
                    console.error('‚ùå WebSocket error:', error);
                    addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©.', 'system-message error');
                };

                // Set a timeout for connection
                setTimeout(() => {
                    if (ws.readyState !== WebSocket.OPEN) {
                        console.warn('‚ö†Ô∏è WebSocket connection timeout');
                        addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ŸÅÿ¥ŸÑ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©. ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿÆÿßÿØŸÖ.', 'system-message error');
                    }
                }, 5000);

            } catch (error) {
                console.error('‚ùå Error creating WebSocket connection:', error);
                addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ŸÜÿ¥ÿßÿ° ÿßÿ™ÿµÿßŸÑ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©.', 'system-message error');
            }
        }

        // Function to check WebSocket status
        function checkWebSocketStatus() {
            if (!ws) {
                console.log('‚ùå WebSocket not initialized');
                return false;
            }
            
            const states = {
                0: 'CONNECTING',
                1: 'OPEN',
                2: 'CLOSING',
                3: 'CLOSED'
            };
            
            const state = states[ws.readyState] || 'UNKNOWN';
            console.log(`üì° WebSocket status: ${state} (${ws.readyState})`);
            
            return ws.readyState === WebSocket.OPEN;
        }

        // Function to manually reconnect WebSocket
        function reconnectWebSocket() {
            console.log('üîÑ Manual WebSocket reconnection requested');
            if (ws) {
                ws.close();
            }
            setTimeout(connectWebSocket, 1000);
        }

        // Initialize chat audio
        chatNotification.volume = chatVolume;
        messageSent.volume = chatVolume;

        // Function to play chat sounds
        function playChatSound(audioElement) {
            if (!isChatMuted && audioElement) {
                audioElement.currentTime = 0;
                audioElement.play().catch(e => {
                    console.log('Chat sound play error:', e);
                });
            }
        }

        // Toggle chat mute
        chatMuteBtn.addEventListener('click', () => {
            isChatMuted = !isChatMuted;
            chatMuteBtn.classList.toggle('muted', isChatMuted);
            
            if (isChatMuted) {
                chatMuteBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                chatMuteBtn.title = 'ÿ•ŸÑÿ∫ÿßÿ° ŸÉÿ™ŸÖ ÿµŸàÿ™ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©';
            } else {
                chatMuteBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                chatMuteBtn.title = 'ŸÉÿ™ŸÖ ÿµŸàÿ™ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©';
            }
        });

        // Toggle chat window
        toggleChatBtn.addEventListener('click', () => {
            isChatCollapsed = !isChatCollapsed;
            chatContainer.classList.toggle('collapsed', isChatCollapsed);
            
            if (isChatCollapsed) {
                toggleChatBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            } else {
                toggleChatBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            }
        });

        // Send message function
        function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Check WebSocket status first
            if (!checkWebSocketStatus()) {
                console.log('‚ùå Cannot send message, WebSocket is not open');
                addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ŸÑÿß ŸäŸÖŸÉŸÜ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©. ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±.', 'system-message error');
                return;
            }
            
            try {
                // Create unique message identifier
                const messageId = `${username}-${Date.now()}-${message}`;
                
                // Send the message through the WebSocket
                ws.send(JSON.stringify({
                    type: 'chat_message',
                    text: message,
                    sender: username,
                    messageId: messageId
                }));
                
                console.log('üì§ Message sent successfully:', message);
                
                // Clear the input field
                chatInput.value = '';
                
                // Play sent message sound
                playChatSound(messageSent);
                
                // Clean up old message IDs after timeout
                setTimeout(() => {
                    sentMessages.delete(messageId);
                }, messageTimeout);
                
            } catch (error) {
                console.error('‚ùå Error sending message:', error);
                addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©.', 'system-message error');
            }
        }

        // Add message to chat
        function addMessageToChat(sender, text, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${type}`;
            
            const time = new Date().toLocaleTimeString('ar-SA', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div class="message-sender">${sender}</div>
                <div class="message-text">${text}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Add animation for new messages
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateY(10px)';
            setTimeout(() => {
                messageDiv.style.transition = 'all 0.3s ease';
                messageDiv.style.opacity = '1';
                messageDiv.style.transform = 'translateY(0)';
            }, 10);
        }

        // Send message on button click
        sendMessageBtn.addEventListener('click', sendMessage);

        // Send message on Enter key
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Emoji picker functionality
        emojiBtn.addEventListener('click', () => {
            emojiPicker.classList.toggle('show');
            soundKeys.classList.remove('show');
        });

        // Sound keys functionality
        soundBtn.addEventListener('click', () => {
            soundKeys.classList.toggle('show');
            emojiPicker.classList.remove('show');
        });

        // Emoji selection
        emojiPicker.addEventListener('click', (e) => {
            if (e.target.classList.contains('emoji-item')) {
                const emoji = e.target.textContent;
                chatInput.value += emoji;
                chatInput.focus();
                emojiPicker.classList.remove('show');
            }
        });

        // Sound key selection
        soundKeys.addEventListener('click', (e) => {
            if (e.target.classList.contains('sound-key')) {
                const soundType = e.target.dataset.sound;
                playSoundKey(soundType);
                soundKeys.classList.remove('show');
            }
        });

        // Close pickers when clicking outside
        document.addEventListener('click', (e) => {
            if (!emojiBtn.contains(e.target) && !emojiPicker.contains(e.target)) {
                emojiPicker.classList.remove('show');
            }
            if (!soundBtn.contains(e.target) && !soundKeys.contains(e.target)) {
                soundKeys.classList.remove('show');
            }
        });

        // Function to play sound keys
        function playSoundKey(soundType) {
            if (isMuted) return;
            
            switch(soundType) {
                case 'win':
                    sounds.win.currentTime = 0;
                    sounds.win.play().catch(e => console.log('Sound key error:', e));
                    break;
                case 'lose':
                    sounds.lose.currentTime = 0;
                    sounds.lose.play().catch(e => console.log('Sound key error:', e));
                    break;
                case 'click':
                    sounds.buttonClick.currentTime = 0;
                    sounds.buttonClick.play().catch(e => console.log('Sound key error:', e));
                    break;
                case 'single':
                    sounds.singleShot.currentTime = 0;
                    sounds.singleShot.play().catch(e => console.log('Sound key error:', e));
                    break;
                case 'triple':
                    sounds.tripleShot.currentTime = 0;
                    sounds.tripleShot.play().catch(e => console.log('Sound key error:', e));
                    break;
                case 'hammer':
                    sounds.hammerShot.currentTime = 0;
                    sounds.hammerShot.play().catch(e => console.log('Sound key error:', e));
                    break;
            }
        }

        // Reconnect WebSocket button
        document.getElementById('reconnectBtn').addEventListener('click', () => {
            reconnectWebSocket();
            addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', 'ÿ¨ÿßÿ±Ÿä ÿ•ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ...', 'system-message');
        });

        // Auto-focus chat input when chat is opened
        toggleChatBtn.addEventListener('click', () => {
            if (!isChatCollapsed) {
                setTimeout(() => chatInput.focus(), 300);
            }
        });

        // Update chat volume when main mute changes
        muteButton.addEventListener('click', () => {
            isMuted = !isMuted;
            Object.values(sounds).forEach(sound => sound.muted = isMuted);
            chatNotification.muted = isMuted;
            messageSent.muted = isMuted;
            muteButton.textContent = isMuted ? 'üîá ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑŸÉÿ™ŸÖ' : 'üîä ŸÉÿ™ŸÖ ÿßŸÑÿµŸàÿ™';
        });

        // Voice Chat Functions
        function showVoiceModal() {
            voiceModal.classList.add('show');
        }

        function hideVoiceModal() {
            voiceModal.classList.remove('show');
        }

        async function enableVoiceChat() {
            try {
                // Request microphone permission
                mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    audio: true, 
                    video: false 
                });
                
                isVoiceChatActive = true;
                voiceChatBtn.classList.add('voice-active');
                voiceChatBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceChatBtn.title = 'ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©';
                voiceChatStatus.style.display = 'block';
                
                hideVoiceModal();
                
                // Simulate connected players (for demo)
                updateConnectedPlayers(3);
                
                // Start voice chat simulation
                startVoiceChatSimulation();
                
                console.log('Voice chat enabled successfully');
            } catch (error) {
                console.error('Error enabling voice chat:', error);
                alert('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÖÿßŸäŸÉÿ±ŸàŸÅŸàŸÜ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ•ÿπÿ∑ÿßÿ° ÿßŸÑÿ•ÿ∞ŸÜ.');
                hideVoiceModal();
            }
        }

        function disableVoiceChat() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            
            isVoiceChatActive = false;
            voiceChatBtn.classList.remove('voice-active');
            voiceChatBtn.innerHTML = '<i class="fas fa-microphone-slash"></i>';
            voiceChatBtn.title = 'ÿ®ÿØÿ° ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿµŸàÿ™Ÿäÿ©';
            voiceChatStatus.style.display = 'none';
            
            // Clear peer connections
            Object.values(peerConnections).forEach(pc => pc.close());
            peerConnections = {};
            
            console.log('Voice chat disabled');
        }

        function updateConnectedPlayers(count) {
            connectedPlayers.innerHTML = `<span>ÿßŸÑŸÑÿßÿπÿ®ŸäŸÜ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ: ${count}</span>`;
        }

        function startVoiceChatSimulation() {
            // Simulate voice activity
            setInterval(() => {
                if (isVoiceChatActive) {
                    const voiceIndicator = document.querySelector('.voice-indicator');
                    if (Math.random() > 0.7) { // 30% chance of voice activity
                        voiceIndicator.classList.add('recording');
                        setTimeout(() => {
                            voiceIndicator.classList.remove('recording');
                        }, 1000 + Math.random() * 2000);
                    }
                }
            }, 3000);
        }

        // Voice Chat Event Listeners
        voiceChatBtn.addEventListener('click', () => {
            if (!isVoiceChatActive) {
                showVoiceModal();
            } else {
                disableVoiceChat();
            }
        });

        enableVoiceBtn.addEventListener('click', enableVoiceChat);
        cancelVoiceBtn.addEventListener('click', hideVoiceModal);

        // Close modal when clicking outside
        voiceModal.addEventListener('click', (e) => {
            if (e.target === voiceModal) {
                hideVoiceModal();
            }
        });

        // Initialize the game
        async function initGame() {
            await loadUserInfo();
            if (!username) {
                window.location.href = 'index.html';
                return;
            }
            await loadGameData();
            createBoxes();
            initializeItemDisplay(); // Initialize item display
            initializeItemInfoModal(); // Initialize item info modal
            updateDisplay();
            checkAudioFiles();
            connectWebSocket();
        }

        // Start the game
        initGame();

        // Function to send fake congratulatory messages
        function sendFakeCongratulations(winAmount) {
            const fakeUsers = [
                'ÿ£ÿ≠ŸÖÿØ_ÿßŸÑŸÑÿßÿπÿ®',
                'ÿ≥ÿßÿ±ÿ©_ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©',
                'ŸÖÿ≠ŸÖÿØ_ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÅ',
                'ŸÅÿßÿ∑ŸÖÿ©_ÿßŸÑŸÜÿ¨ŸÖÿ©',
                'ÿπŸÑŸä_ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±ÿ©',
                'ŸÜŸàÿ±_ÿßŸÑÿ∑ŸÖŸàÿ≠',
                'ÿ≠ÿ≥ŸÜ_ÿßŸÑÿ∞ŸÉŸä',
                'ŸÑŸäŸÑŸâ_ÿßŸÑŸÖÿßŸáÿ±ÿ©'
            ];
            
            const congratulations = [
                `ŸÖÿ®ÿ±ŸàŸÉ! ÿ±ÿ®ÿ≠ÿ™ ${winAmount} ÿπŸÖŸÑÿ© üéâ`,
                `ÿ£ÿ≠ÿ≥ŸÜÿ™! ŸÅŸàÿ≤ ÿ±ÿßÿ¶ÿπ ÿ®ŸÄ ${winAmount} ÿπŸÖŸÑÿ© üèÜ`,
                `ŸÖÿ®ÿ±ŸàŸÉ ÿπŸÑŸâ ÿßŸÑŸÅŸàÿ≤! ${winAmount} ÿπŸÖŸÑÿ© ÿ¨ÿØŸäÿØÿ© üí∞`,
                `ÿ±ÿßÿ¶ÿπ! ${winAmount} ÿπŸÖŸÑÿ© ŸÅŸä ÿ¨Ÿäÿ®ŸÉ ÿßŸÑÿ¢ŸÜ üéä`,
                `ÿ£ŸÑŸÅ ŸÖÿ®ÿ±ŸàŸÉ! ${winAmount} ÿπŸÖŸÑÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© üéØ`,
                `ŸÅŸàÿ≤ ÿ¨ŸÖŸäŸÑ! ${winAmount} ÿπŸÖŸÑÿ© ÿ¨ÿØŸäÿØÿ© ü•≥`,
                `ŸÖÿ®ÿ±ŸàŸÉ ÿπŸÑŸâ ÿßŸÑŸÜÿ¨ÿßÿ≠! ${winAmount} ÿπŸÖŸÑÿ© üé™`,
                `ÿ£ÿ≠ÿ≥ŸÜÿ™! ${winAmount} ÿπŸÖŸÑÿ© ŸÅŸä ÿßŸÑÿ≠ÿ≥ÿßÿ® üé®`
            ];
            
            // Send 2-4 congratulatory messages
            const numMessages = Math.floor(Math.random() * 3) + 2; // 2-4 messages
            
            for (let i = 0; i < numMessages; i++) {
                setTimeout(() => {
                    const randomUser = fakeUsers[Math.floor(Math.random() * fakeUsers.length)];
                    const randomCongratulation = congratulations[Math.floor(Math.random() * congratulations.length)];
                    
                    // Add the fake message to chat
                    addMessageToChat(randomUser, randomCongratulation, 'other');
                    
                    // Play notification sound
                    playChatSound(chatNotification);
                    
                    console.log(`ü§ñ Fake message from ${randomUser}: ${randomCongratulation}`);
                }, (i + 1) * 2000); // Send messages with 2-second intervals
            }
        }

        // Function to send fake reactions to losses
        function sendFakeLossReactions() {
            const fakeUsers = [
                'ÿ£ÿ≠ŸÖÿØ_ÿßŸÑŸÑÿßÿπÿ®',
                'ÿ≥ÿßÿ±ÿ©_ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©',
                'ŸÖÿ≠ŸÖÿØ_ÿßŸÑŸÖÿ≠ÿ™ÿ±ŸÅ',
                'ŸÅÿßÿ∑ŸÖÿ©_ÿßŸÑŸÜÿ¨ŸÖÿ©',
                'ÿπŸÑŸä_ÿßŸÑÿ£ÿ≥ÿ∑Ÿàÿ±ÿ©',
                'ŸÜŸàÿ±_ÿßŸÑÿ∑ŸÖŸàÿ≠',
                'ÿ≠ÿ≥ŸÜ_ÿßŸÑÿ∞ŸÉŸä',
                'ŸÑŸäŸÑŸâ_ÿßŸÑŸÖÿßŸáÿ±ÿ©'
            ];
            
            const lossReactions = [
                'ŸÑÿß ÿ™ÿ≠ÿ≤ŸÜÿå ÿ≠ÿ∏ ÿ£ŸàŸÅÿ± ŸÅŸä ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©! üòä',
                'Ÿáÿ∞ÿß Ÿäÿ≠ÿØÿ´ ŸÑŸÑÿ¨ŸÖŸäÿπÿå ÿ¨ÿ±ÿ® ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ! üí™',
                'ŸÑÿß ÿ™ÿ≥ÿ™ÿ≥ŸÑŸÖÿå ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ≥ÿ™ŸÉŸàŸÜ ÿ£ŸÅÿ∂ŸÑ! üåü',
                'ÿ≠ÿ∏ ÿ£ŸàŸÅÿ± ŸÅŸä ÿßŸÑÿ¨ŸàŸÑÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©! üçÄ',
                'ŸÑÿß ÿ™ŸÇŸÑŸÇÿå ÿ≥ÿ™ŸÜÿ¨ÿ≠ ŸÅŸä ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ©! ‚ú®',
                'Ÿáÿ∞ÿß ÿ¨ÿ≤ÿ° ŸÖŸÜ ÿßŸÑŸÑÿπÿ®ÿ©ÿå ÿßÿ≥ÿ™ŸÖÿ±! üéÆ',
                'ÿ≠ÿ∏ ÿ£ŸàŸÅÿ±ÿå ÿ¨ÿ±ÿ® ÿ∂ÿ±ÿ®ÿ© ŸÖÿÆÿ™ŸÑŸÅÿ©! üéØ',
                'ŸÑÿß ÿ™ÿ≠ÿ®ÿ∑ÿå ÿßŸÑŸÖÿ±ÿ© ÿßŸÑŸÇÿßÿØŸÖÿ© ÿ≥ÿ™ŸÉŸàŸÜ ŸÑŸÉ! üé™'
            ];
            
            // Send 1-2 encouraging messages
            const numMessages = Math.floor(Math.random() * 2) + 1; // 1-2 messages
            
            for (let i = 0; i < numMessages; i++) {
                setTimeout(() => {
                    const randomUser = fakeUsers[Math.floor(Math.random() * fakeUsers.length)];
                    const randomReaction = lossReactions[Math.floor(Math.random() * lossReactions.length)];
                    
                    // Add the fake message to chat
                    addMessageToChat(randomUser, randomReaction, 'other');
                    
                    // Play notification sound
                    playChatSound(chatNotification);
                    
                    console.log(`ü§ñ Fake loss reaction from ${randomUser}: ${randomReaction}`);
                }, (i + 1) * 3000); // Send messages with 3-second intervals
            }
        }

        // Item Info Modal Functions
        function initializeItemInfoModal() {
            const modal = document.getElementById('itemInfoModal');
            const openBtn = document.getElementById('itemInfoBtn');
            const closeBtn = document.getElementById('itemInfoClose');
            
            openBtn.addEventListener('click', () => {
                populateItemInfoModal();
                modal.classList.add('show');
            });
            
            closeBtn.addEventListener('click', () => {
                modal.classList.remove('show');
            });
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        }

        function populateItemInfoModal() {
            const itemInfoGrid = document.getElementById('itemInfoGrid');
            const collectionGoalsList = document.getElementById('collectionGoalsList');
            
            // Clear previous content
            itemInfoGrid.innerHTML = '';
            collectionGoalsList.innerHTML = '';
            
            // Add item cards
            Object.entries(ITEM_REWARDS).forEach(([itemType, itemData]) => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-info-card';
                
                const pointsClass = itemData.points >= 0 ? 'positive' : 'negative';
                const pointsText = itemData.points >= 0 ? `+${itemData.points}` : `${itemData.points}`;
                
                itemCard.innerHTML = `
                    <div class="item-info-emoji">${itemData.emoji}</div>
                    <div class="item-info-details">
                        <div class="item-info-name">${itemData.name}</div>
                        <div class="item-info-description">${getItemDescription(itemType)}</div>
                        <div class="item-info-points ${pointsClass}">${pointsText} ŸÜŸÇÿ∑ÿ©</div>
                    </div>
                `;
                
                itemInfoGrid.appendChild(itemCard);
            });
            
            // Add collection goals
            Object.entries(COLLECTION_GOALS).forEach(([itemType, goal]) => {
                const itemData = ITEM_REWARDS[itemType];
                if (!itemData) return; // Skip if not defined
                const goalItem = document.createElement('div');
                goalItem.className = 'collection-goal-item';
                
                goalItem.innerHTML = `
                    <div class="collection-goal-info">
                        <div class="collection-goal-emoji">${itemData.emoji}</div>
                        <div class="collection-goal-text">ÿßÿ¨ŸÖÿπ ${goal.target} ${goal.name}</div>
                    </div>
                    <div class="collection-goal-reward">+${goal.reward} ŸÜŸÇÿ∑ÿ©</div>
                `;
                
                collectionGoalsList.appendChild(goalItem);
            });
        }

        function getItemDescription(itemType) {
            const descriptions = {
                gem: 'ÿ¨ŸàŸáÿ±ÿ© ÿ´ŸÖŸäŸÜÿ© ÿ™ŸÖŸÜÿ≠ŸÉ ŸÜŸÇÿßÿ∑ ÿ•ÿ∂ÿßŸÅŸäÿ©. ÿßÿ¨ŸÖÿπ 5 ÿ¨ŸàÿßŸáÿ± ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÉÿßŸÅÿ£ÿ© ŸÉÿ®Ÿäÿ±ÿ©!',
                key: 'ŸÖŸÅÿ™ÿßÿ≠ ÿ≥ÿ≠ÿ±Ÿä ŸäŸÅÿ™ÿ≠ ÿ£ÿ®Ÿàÿßÿ® ÿßŸÑÿ´ÿ±Ÿàÿ©. ÿßÿ¨ŸÖÿπ 3 ŸÖŸÅÿßÿ™Ÿäÿ≠ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÉÿßŸÅÿ£ÿ©!',
                coin: 'ÿπŸÖŸÑÿ© ÿ∞Ÿáÿ®Ÿäÿ© ÿ™ÿ≤ŸäÿØ ŸÖŸÜ ÿ±ÿµŸäÿØŸÉ. ÿ¨ŸÖÿπ ÿßŸÑŸÖÿ≤ŸäÿØ ŸäÿπŸÜŸä ÿßŸÑŸÖÿ≤ŸäÿØ ŸÖŸÜ ÿßŸÑŸÜŸÇÿßÿ∑!',
                bomb: 'ŸÇŸÜÿ®ŸÑÿ© ÿÆÿ∑Ÿäÿ±ÿ©! ÿ™ÿ¨ŸÜÿ®Ÿáÿß ÿ£Ÿà ÿ≥ÿ™ÿÆÿ≥ÿ± ŸÜŸÇÿßÿ∑. ŸÉŸÜ ÿ≠ÿ∞ÿ±ÿßŸã!',
                star: 'ŸÜÿ¨ŸÖÿ© ÿ≥ÿßÿ∑ÿπÿ© ÿ™ŸÖŸÜÿ≠ŸÉ ŸÜŸÇÿßÿ∑ ÿπÿßŸÑŸäÿ©. ÿßÿ¨ŸÖÿπ ŸÜÿ¨ŸÖÿ™ŸäŸÜ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÖŸÉÿßŸÅÿ£ÿ©!',
                bat: 'ÿÆŸÅÿßÿ¥ ÿ¥ÿ±Ÿäÿ± ŸäÿÆÿµŸÖ ŸÖŸÜ ŸÜŸÇÿßÿ∑ŸÉ. ÿßÿ≠ÿ∞ÿ± ŸÖŸÜŸá!'
            };
            
            return descriptions[itemType] || 'ÿπŸÜÿµÿ± ÿ∫ÿßŸÖÿ∂ ŸÅŸä ÿßŸÑŸÑÿπÿ®ÿ©.';
        }

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            // The game is already initialized with initGame() call above
            // Just initialize the additional features
            initializeItemInfoModal();
            
            // Uncomment the line below to test effects on page load
            // testEffects();
        });

        // Close win/loss containers on close button click
        document.getElementById('closeWinGif').onclick = function() {
            document.getElementById('win-gif-container').style.display = 'none';
        };
        document.getElementById('closeSadcatGif').onclick = function() {
            document.getElementById('sadcat-gif-container').style.display = 'none';
        };

        function showWinEffect(amount) {
            const overlay = document.getElementById('effect-overlay');
            const img = document.getElementById('effect-image');
            const audio = document.getElementById('effect-audio');
            img.src = '/images/win.gif'; // ÿπÿØŸÑ ŸÑŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ
            audio.src = '/sounds/win.mp3'; // ÿπÿØŸÑ ŸÑŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ
            overlay.style.display = 'flex';
            audio.currentTime = 0;
            audio.play();
            setTimeout(() => {
                overlay.style.display = 'none';
                audio.pause();
            }, 2500);
        }

        function showLoseEffect(amount) {
            const overlay = document.getElementById('effect-overlay');
            const img = document.getElementById('effect-image');
            const audio = document.getElementById('effect-audio');
            img.src = '/images/lose.gif'; // ÿπÿØŸÑ ŸÑŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ
            audio.src = '/sounds/lose.mp3'; // ÿπÿØŸÑ ŸÑŸÑŸÖÿ≥ÿßÿ± ÿßŸÑÿµÿ≠Ÿäÿ≠ ÿ•ÿ∞ÿß ŸÑÿ≤ŸÖ
            overlay.style.display = 'flex';
            audio.currentTime = 0;
            audio.play();
            setTimeout(() => {
                overlay.style.display = 'none';
                audio.pause();
            }, 2500);
        }

        // Test function to verify effects are working
        function testEffects() {
            console.log('üß™ Testing win/lose effects...');
            
            // Test win effect
            setTimeout(() => {
                console.log('üéâ Testing win effect...');
                showWinEffect(1000);
            }, 1000);
            
            // Test lose effect
            setTimeout(() => {
                console.log('üò¢ Testing lose effect...');
                showLoseEffect(500);
            }, 6000);
        }

        // Function to determine box type based on bet type
        function determineBoxType(betType) {
            const random = Math.random();
            
            if (betType === 'single') {
                // Single shot: 40% coins only, 30% items only, 20% both, 10% empty
                if (random < 0.4) return 'coins_only';
                else if (random < 0.7) return 'items_only';
                else if (random < 0.9) return 'both';
                else return 'empty';
            } else if (betType === 'triple') {
                // Triple shot: 35% coins only, 35% items only, 25% both, 5% empty
                if (random < 0.35) return 'coins_only';
                else if (random < 0.7) return 'items_only';
                else if (random < 0.95) return 'both';
                else return 'empty';
            } else if (betType === 'hammer') {
                // Hammer shot: 25% coins only, 40% items only, 30% both, 5% empty
                if (random < 0.25) return 'coins_only';
                else if (random < 0.65) return 'items_only';
                else if (random < 0.95) return 'both';
                else return 'empty';
            }
            
            return 'coins_only'; // Default fallback
        }

        // Function to process box content based on type
        function processBox(boxType, bet, numBoxes) {
            const result = {
                hasCoins: false,
                hasItem: false,
                coinAmount: 0,
                item: null
            };

            switch (boxType) {
                case 'coins_only':
                    // Box contains only coins (no items)
                    const winChance = 0.4; // 40% chance to win
                    if (Math.random() < winChance) {
                        result.hasCoins = true;
                        result.coinAmount = bet.cost * bet.multiplier / numBoxes;
                    }
                    break;
                    
                case 'items_only':
                    // Box contains only items (no coins)
                    const itemChance = 0.8; // 80% chance to find item
                    if (Math.random() < itemChance) {
                        result.hasItem = true;
                        result.item = generateRandomItem();
                    }
                    break;
                    
                case 'both':
                    // Box can contain both coins and items
                    const coinWinChance = 0.3; // 30% chance to win coins
                    const itemChance2 = 0.7; // 70% chance to find item
                    
                    if (Math.random() < coinWinChance) {
                        result.hasCoins = true;
                        result.coinAmount = bet.cost * bet.multiplier / numBoxes;
                    }
                    
                    if (Math.random() < itemChance2) {
                        result.hasItem = true;
                        result.item = generateRandomItem();
                    }
                    break;
                    
                case 'empty':
                    // Box is completely empty
                    // 5% chance to find something anyway (lucky find)
                    const luckyChance = 0.05;
                    if (Math.random() < luckyChance) {
                        if (Math.random() < 0.5) {
                            result.hasCoins = true;
                            result.coinAmount = bet.cost * 0.5 / numBoxes; // Reduced amount
                        } else {
                            result.hasItem = true;
                            result.item = generateRandomItem();
                        }
                    }
                    break;
            }

            return result;
        }

        function handleWSData(data) {
            console.log('üì® WebSocket message received:', data);
            if (data.type === 'chat_message') {
                if (data.messageId && sentMessages.has(data.messageId)) {
                    console.log('üîÑ Duplicate message detected, skipping:', data.messageId);
                    return;
                }
                if (data.messageId) {
                    sentMessages.add(data.messageId);
                }
                const messageType = data.sender === username ? 'own' : 'other';
                addMessageToChat(data.sender, data.text, messageType);
                if (messageType === 'other') {
                    playChatSound(chatNotification);
                }
            } else if (data.type === 'player_joined') {
                addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', `ÿßŸÜÿ∂ŸÖ ÿßŸÑŸÑÿßÿπÿ® ${data.username} ÿ•ŸÑŸâ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©`, 'system-message');
            } else if (data.type === 'player_left') {
                addMessageToChat('ÿßŸÑŸÜÿ∏ÿßŸÖ', `ÿ∫ÿßÿØÿ± ÿßŸÑŸÑÿßÿπÿ® ${data.username} ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©`, 'system-message');
            } else if (data.type === 'ping') {
                ws.send(JSON.stringify({ type: 'pong' }));
            } else if (data.type === 'box_opened') {
                const allBoxes = document.querySelectorAll('.box');
                const box = allBoxes[data.boxIndex];
                if (box && !box.classList.contains('opened')) {
                    box.classList.add('opened');
                    let boxText = box.querySelector('.box-text');
                    if (!boxText) {
                        boxText = document.createElement('div');
                        boxText.className = 'box-text';
                        box.appendChild(boxText);
                    }
                    if (data.result === 'win') {
                        boxText.textContent = `üí∞ ${data.amount}`;
                        box.style.backgroundColor = '#28a745';
                        box.style.border = '3px solid #20c997';
                    } else if (data.result === 'item') {
                        boxText.textContent = `${data.item} ${data.points >= 0 ? '+' : ''}${data.points}`;
                        boxText.style.color = data.points >= 0 ? '#fff' : '#ff6b6b';
                        box.style.backgroundColor = data.points >= 0 ? '#17a2b8' : '#dc3545';
                        box.style.border = data.points >= 0 ? '3px solid #20c997' : '3px solid #ff6b6b';
                    } else if (data.result === 'empty') {
                        boxText.textContent = 'üì¶ ŸÅÿßÿ±ÿ∫';
                        boxText.style.color = '#6c757d';
                        box.style.backgroundColor = '#6c757d';
                        box.style.border = '3px solid #495057';
                    }
                }
            }
        }

        // Event Listeners
    </script>
    <script>
    document.getElementById('effect-close-btn').onclick = function() {
      const overlay = document.getElementById('effect-overlay');
      const audio = document.getElementById('effect-audio');
      overlay.style.display = 'none';
      audio.pause();
    };
    </script>
    <script>
        async function loadUserInfo() {
            const token = localStorage.getItem('token');
            if (!token) return;
            try {
                const response = await fetch(`${BACKEND_URL}/api/users/me`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) return;
                const data = await response.json();
                username = data.username;
                document.getElementById('username-display').textContent = data.username || '';
                if (data.playerId) {
                    let playerIdElem = document.getElementById('playerid-display');
                    if (!playerIdElem) {
                        playerIdElem = document.createElement('span');
                        playerIdElem.id = 'playerid-display';
                        document.getElementById('username-display').parentNode.appendChild(playerIdElem);
                    }
                    playerIdElem.textContent = ` (ID: ${data.playerId})`;
                }
            } catch (e) {
                console.error('Failed to load user info', e);
            }
        }
    </script>
</body>
</html>


